<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenNotes Desktop</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Tebby2008/OpenNotes/main/resources/favicon.png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <!-- MathLive for LaTeX -->
  <script src="https://unpkg.com/mathlive"></script>
  
  <!-- Mermaid for diagrams -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  
  <!-- Marked for Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
  
  <!-- DOMPurify for sanitization -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.6/dist/purify.min.js"></script>
  
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
  <div id="app">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header" data-tauri-drag-region>
        <span class="logo-text" data-tauri-drag-region>OpenNotes <span class="accent">Desktop</span></span>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <span class="nav-label">Browse</span>
          <a href="#" class="nav-item active" data-view="browse">
            <span class="material-symbols-rounded">folder_open</span>
            All Notes
          </a>
          <a href="#" class="nav-item" data-view="recent">
            <span class="material-symbols-rounded">schedule</span>
            Recent
          </a>
          <a href="#" class="nav-item" data-view="downloads">
            <span class="material-symbols-rounded">download</span>
            Downloads
          </a>
        </div>
        
        <div class="nav-section">
          <span class="nav-label">Create</span>
          <a href="#" class="nav-item" data-view="editor">
            <span class="material-symbols-rounded">edit_note</span>
            New Document
          </a>
          <a href="#" class="nav-item" data-view="upload" id="nav-upload">
            <span class="material-symbols-rounded">upload_file</span>
            Upload Notes
          </a>
        </div>
        
        <div class="nav-section">
          <span class="nav-label">Problem Sets</span>
          <a href="#" class="nav-item" data-view="quiz-browse">
            <span class="material-symbols-rounded">quiz</span>
            Browse Sets
          </a>
          <a href="#" class="nav-item" data-view="quiz-create">
            <span class="material-symbols-rounded">add_circle</span>
            Create Set
          </a>
        </div>
        
        <div class="nav-section">
          <span class="nav-label">Manage</span>
          <a href="#" class="nav-item" data-view="storage">
            <span class="material-symbols-rounded">hard_drive</span>
            Storage
          </a>
        </div>
      </nav>
      
      <div class="sidebar-footer">
        <div class="storage-indicator">
          <div class="storage-bar">
            <div class="storage-used" id="storage-used-bar"></div>
          </div>
          <span class="storage-text" id="storage-text">-- / -- MB used</span>
        </div>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main id="main-content" class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <button id="sidebar-toggle" class="icon-btn mobile-only">
            <span class="material-symbols-rounded">menu</span>
          </button>
          <h1 id="view-title" class="view-title">All Notes</h1>
        </div>
        <div class="header-right">
          <div class="search-container">
            <span class="material-symbols-rounded">search</span>
            <input type="text" id="search-input" placeholder="Search notes..." class="search-input">
          </div>
          <button id="theme-toggle" class="icon-btn" title="Toggle theme">
            <span class="material-symbols-rounded">dark_mode</span>
          </button>
        </div>
      </header>
      
      <!-- Views Container -->
      <div id="views-container" class="views-container">
        <!-- Browse View -->
        <section id="view-browse" class="view active">
          <div class="view-toolbar">
            <div class="filter-chips">
              <button class="filter-chip active" data-format="all">All</button>
              <button class="filter-chip" data-format="pdf">PDF</button>
              <button class="filter-chip" data-format="docx">DOCX</button>
              <button class="filter-chip" data-format="pptx">PPTX</button>
              <button class="filter-chip" data-format="xlsx">XLSX</button>
              <button class="filter-chip" data-format="txt">TXT</button>
              <button class="filter-chip" data-format="md">MD</button>
              <button class="filter-chip" data-format="images">Images</button>
              <button class="filter-chip" data-format="other">Other</button>
            </div>
            <div class="toolbar-actions">
              <button id="refresh-btn" class="icon-btn" title="Refresh notes">
                <span class="material-symbols-rounded">refresh</span>
              </button>
              <select id="sort-select" class="sort-select">
                <option value="views">Most Viewed</option>
                <option value="downloads">Most Downloaded</option>
                <option value="recent">Recently Added</option>
                <option value="name">Name A-Z</option>
              </select>
            </div>
          </div>
          <div id="notes-grid" class="notes-grid">
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Loading notes...</p>
            </div>
          </div>
          <div id="pagination" class="pagination"></div>
        </section>
        
        <!-- Recent View -->
        <section id="view-recent" class="view">
          <div id="recent-content" class="notes-grid"></div>
        </section>
        
        <!-- Downloads View -->
        <section id="view-downloads" class="view">
          <div class="empty-state" id="downloads-empty">
            <span class="material-symbols-rounded">download</span>
            <h3>No downloaded notes</h3>
            <p>Download notes for offline access by clicking the download icon</p>
          </div>
          <div id="downloads-grid" class="notes-grid"></div>
        </section>
        
        <!-- Editor View -->
        <section id="view-editor" class="view">
          <div class="editor-container">
            <div class="editor-toolbar">
              <div class="toolbar-group">
                <button class="tool-btn" data-action="bold" title="Bold">
                  <span class="material-symbols-rounded">format_bold</span>
                </button>
                <button class="tool-btn" data-action="italic" title="Italic">
                  <span class="material-symbols-rounded">format_italic</span>
                </button>
                <button class="tool-btn" data-action="underline" title="Underline">
                  <span class="material-symbols-rounded">format_underlined</span>
                </button>
                <button class="tool-btn" data-action="strikethrough" title="Strikethrough">
                  <span class="material-symbols-rounded">strikethrough_s</span>
                </button>
              </div>
              <div class="toolbar-divider"></div>
              <div class="toolbar-group">
                <button class="tool-btn" data-action="heading1" title="Heading 1">
                  <span>H1</span>
                </button>
                <button class="tool-btn" data-action="heading2" title="Heading 2">
                  <span>H2</span>
                </button>
                <button class="tool-btn" data-action="heading3" title="Heading 3">
                  <span>H3</span>
                </button>
              </div>
              <div class="toolbar-divider"></div>
              <div class="toolbar-group">
                <button class="tool-btn" data-action="bullet-list" title="Bullet List">
                  <span class="material-symbols-rounded">format_list_bulleted</span>
                </button>
                <button class="tool-btn" data-action="numbered-list" title="Numbered List">
                  <span class="material-symbols-rounded">format_list_numbered</span>
                </button>
                <button class="tool-btn" data-action="task-list" title="Task List">
                  <span class="material-symbols-rounded">checklist</span>
                </button>
              </div>
              <div class="toolbar-divider"></div>
              <div class="toolbar-group">
                <button class="tool-btn" data-action="math" title="Insert Math (LaTeX)">
                  <span class="material-symbols-rounded">function</span>
                </button>
                <button class="tool-btn" data-action="code" title="Code Block">
                  <span class="material-symbols-rounded">code</span>
                </button>
                <button class="tool-btn" data-action="table" title="Insert Table">
                  <span class="material-symbols-rounded">table_chart</span>
                </button>
                <button class="tool-btn" data-action="link" title="Insert Link">
                  <span class="material-symbols-rounded">link</span>
                </button>
              </div>
              <div class="toolbar-spacer"></div>
              <div class="toolbar-group">
                <button class="tool-btn" id="toggle-preview" title="Toggle Preview">
                  <span class="material-symbols-rounded">visibility</span>
                </button>
                <button class="tool-btn" id="toggle-raw" title="Toggle Raw Mode">
                  <span class="material-symbols-rounded">code_blocks</span>
                </button>
              </div>
            </div>
            
            <div class="editor-header">
              <input type="text" id="doc-title" class="doc-title-input" placeholder="Untitled Document">
            </div>
            
            <div class="editor-content">
              <div id="editor" class="editor" contenteditable="true">
                <p>Start typing your document...</p>
              </div>
              <div id="preview" class="preview hidden"></div>
            </div>
            
            <div class="editor-footer">
              <span id="word-count">0 words</span>
              <div class="editor-actions">
                <button class="btn btn-secondary" id="save-draft">Save Draft</button>
                <button class="btn btn-secondary" id="export-doc">Export</button>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Upload View -->
        <section id="view-upload" class="view">
          <div class="empty-state">
            <span class="material-symbols-rounded">cloud_upload</span>
            <h3>Upload via Web Client</h3>
            <p>Note uploads are handled through the OpenNotes web client</p>
            <button class="btn btn-secondary btn-small" id="open-web-upload">
              <span class="material-symbols-rounded">language</span>
              Open Web Client
            </button>
          </div>
        </section>
        
        <!-- Storage View -->
        <section id="view-storage" class="view">
          <div class="storage-dashboard">
            <div class="storage-overview">
              <div class="storage-chart">
                <svg viewBox="0 0 120 120" class="storage-ring">
                  <circle cx="60" cy="60" r="50" class="storage-ring-bg"></circle>
                  <circle cx="60" cy="60" r="50" class="storage-ring-value" id="storage-ring"></circle>
                </svg>
                <div class="storage-center">
                  <span class="storage-percent" id="storage-percent">0%</span>
                  <span class="storage-label">Used</span>
                </div>
              </div>
              <div class="storage-details">
                <h3>Storage Usage</h3>
                <div class="storage-stat">
                  <span class="label">Total Space</span>
                  <span class="value" id="total-space">500 MB</span>
                </div>
                <div class="storage-stat">
                  <span class="label">Used Space</span>
                  <span class="value" id="used-space">0 MB</span>
                </div>
                <div class="storage-stat">
                  <span class="label">Available</span>
                  <span class="value" id="available-space">500 MB</span>
                </div>
                <div class="storage-stat">
                  <span class="label">Saved Notes</span>
                  <span class="value" id="saved-count">0</span>
                </div>
              </div>
            </div>
            
            <div class="storage-breakdown">
              <h3>Storage Breakdown</h3>
              <div id="storage-breakdown-list" class="breakdown-list"></div>
            </div>
            
            <div class="storage-actions">
              <button class="btn btn-secondary" id="clear-cache">
                <span class="material-symbols-rounded">delete_sweep</span>
                Clear Cache
              </button>
              <button class="btn btn-danger" id="clear-all">
                <span class="material-symbols-rounded">delete_forever</span>
                Clear All Offline Data
              </button>
            </div>
          </div>
        </section>
        
        <!-- Quiz Browse View -->
        <section id="view-quiz-browse" class="view">
          <div class="quiz-browser">
            <div class="view-toolbar quiz-toolbar">
              <div class="quiz-filter-row">
                <input type="text" id="quiz-subject-filter" list="quiz-browse-subject-suggestions" placeholder="Filter by subject..." class="quiz-filter-input">
                <datalist id="quiz-browse-subject-suggestions">
                  <option value="IB Math AA HL">
                  <option value="IB Math AA SL">
                  <option value="IB Math AI HL">
                  <option value="IB Math AI SL">
                  <option value="IB Physics">
                  <option value="IB Chemistry">
                  <option value="IB Biology">
                </datalist>
                <button id="quiz-filter-clear" class="btn btn-text" title="Clear filter">Clear</button>
              </div>
              <div class="toolbar-actions">
                <button id="quiz-shuffle-btn" class="btn btn-secondary" title="Shuffle selected quizzes">
                  <span class="material-symbols-rounded">shuffle</span>
                  Shuffle Selected
                </button>
                <button id="quiz-refresh-btn" class="icon-btn" title="Refresh quizzes">
                  <span class="material-symbols-rounded">refresh</span>
                </button>
              </div>
            </div>
            <div id="quiz-grid" class="quiz-grid">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading quizzes...</p>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Problem Set Create View -->
        <section id="view-quiz-create" class="view">
          <div class="quiz-creator">
            <div class="quiz-meta">
              <div class="quiz-meta-header">
                <span class="material-symbols-rounded" style="font-size:28px;color:var(--accent);">quiz</span>
                <div>
                  <h3 style="margin:0;font-size:1.1rem;">Problem Set Details</h3>
                  <p style="margin:0;font-size:0.8rem;color:var(--text-muted);">Fill in the info below, then add questions</p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="quiz-title">Title *</label>
                  <input type="text" id="quiz-title" placeholder="e.g., Calculus Integration Practice">
                </div>
                <div class="form-group">
                  <label for="quiz-subject">Subject *</label>
                  <input type="text" id="quiz-subject" list="quiz-subject-suggestions" placeholder="e.g., IB Math AA HL" autocomplete="off">
                  <datalist id="quiz-subject-suggestions">
                    <option value="IB Math AA HL">
                    <option value="IB Math AA SL">
                    <option value="IB Math AI HL">
                    <option value="IB Math AI SL">
                    <option value="IB Physics">
                    <option value="IB Chemistry">
                    <option value="IB Biology">
                    <option value="IB Computer Science">
                    <option value="IB Economics">
                    <option value="IB English">
                    <option value="IB History">
                    <option value="AP Calculus">
                    <option value="AP Physics">
                    <option value="AP Chemistry">
                    <option value="AP Biology">
                  </datalist>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="quiz-topic">Topic</label>
                  <input type="text" id="quiz-topic" placeholder="e.g., Integration by Parts">
                </div>
                <div class="form-group">
                  <label for="quiz-tags">Tags (comma-separated)</label>
                  <input type="text" id="quiz-tags" placeholder="e.g., calculus, integration, ib">
                </div>
              </div>
              <div class="form-group">
                <label for="quiz-description">Description (optional)</label>
                <textarea id="quiz-description" placeholder="Briefly describe what this problem set covers..." rows="2" style="resize:vertical;"></textarea>
              </div>
            </div>
            
            <div class="questions-container">
              <div class="questions-header">
                <h3>Questions</h3>
                <div class="question-add-btns">
                  <button class="btn btn-secondary" id="add-mcq-btn" title="Multiple Choice">
                    <span class="material-symbols-rounded">radio_button_checked</span>
                    MCQ
                  </button>
                  <button class="btn btn-secondary" id="add-tf-btn" title="True or False">
                    <span class="material-symbols-rounded">check_circle</span>
                    T/F
                  </button>
                  <button class="btn btn-secondary" id="add-fitb-btn" title="Fill in the Blank">
                    <span class="material-symbols-rounded">text_fields</span>
                    Fill Blank
                  </button>
                  <button class="btn btn-secondary" id="add-matching-btn" title="Matching Pairs">
                    <span class="material-symbols-rounded">compare_arrows</span>
                    Match
                  </button>
                  <button class="btn btn-secondary" id="add-frq-btn" title="Free Response">
                    <span class="material-symbols-rounded">edit</span>
                    FRQ
                  </button>
                </div>
              </div>
              <div id="questions-list" class="questions-list">
                <div class="empty-state">
                  <span class="material-symbols-rounded">help_outline</span>
                  <h3>No questions yet</h3>
                  <p>Add questions using the buttons above</p>
                </div>
              </div>
            </div>
            
            <!-- SVG Shape Builder -->
            <div class="svg-builder-container hidden" id="svg-builder-container">
              <div class="svg-builder-header">
                <h3>Shape Builder</h3>
                <button class="icon-btn" id="svg-builder-close">
                  <span class="material-symbols-rounded">close</span>
                </button>
              </div>
              <div class="svg-builder-toolbar">
                <button class="icon-btn svg-tool active" data-tool="rect" title="Rectangle">
                  <span class="material-symbols-rounded">rectangle</span>
                </button>
                <button class="icon-btn svg-tool" data-tool="circle" title="Circle">
                  <span class="material-symbols-rounded">circle</span>
                </button>
                <button class="icon-btn svg-tool" data-tool="line" title="Line">
                  <span class="material-symbols-rounded">horizontal_rule</span>
                </button>
                <button class="icon-btn svg-tool" data-tool="arrow" title="Arrow">
                  <span class="material-symbols-rounded">arrow_right_alt</span>
                </button>
                <button class="icon-btn svg-tool" data-tool="text" title="Text">
                  <span class="material-symbols-rounded">title</span>
                </button>
                <span class="svg-tool-divider"></span>
                <input type="color" id="svg-fill-color" value="#3b82f6" title="Fill color" class="svg-color-input">
                <input type="color" id="svg-stroke-color" value="#1e293b" title="Stroke color" class="svg-color-input">
                <button class="icon-btn" id="svg-undo" title="Undo">
                  <span class="material-symbols-rounded">undo</span>
                </button>
                <button class="icon-btn" id="svg-clear" title="Clear">
                  <span class="material-symbols-rounded">delete_sweep</span>
                </button>
              </div>
              <svg id="svg-canvas" class="svg-canvas" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg"></svg>
              <div class="svg-builder-actions">
                <button class="btn btn-secondary" id="svg-cancel">Cancel</button>
                <button class="btn btn-primary" id="svg-insert">Insert Shape</button>
              </div>
            </div>
            
            <div class="quiz-actions">
              <button class="btn btn-secondary" id="preview-quiz-btn">
                <span class="material-symbols-rounded">visibility</span>
                Preview
              </button>
              <button class="btn btn-primary" id="save-quiz-btn">
                <span class="material-symbols-rounded">save</span>
                Save Problem Set
              </button>
            </div>
          </div>
        </section>
        
        <!-- Problem Set Taking View -->
        <section id="view-quiz-take" class="view">
          <div class="quiz-player">
            <div class="quiz-header">
              <div class="quiz-info">
                <h2 id="quiz-player-title">Problem Set</h2>
                <div style="display:flex;align-items:center;gap:12px;">
                  <span id="quiz-player-progress" class="quiz-progress">Question 1 of 10</span>
                  <span id="quiz-timer" class="quiz-timer"></span>
                </div>
              </div>
              <button class="btn btn-text" id="quit-quiz-btn">
                <span class="material-symbols-rounded">close</span>
                Quit
              </button>
            </div>
            
            <!-- Progress bar -->
            <div class="quiz-progress-bar">
              <div id="quiz-progress-fill" class="quiz-progress-fill" style="width:0%"></div>
            </div>
            
            <!-- Question dots navigation -->
            <div id="quiz-dots" class="quiz-dots"></div>
            
            <div class="quiz-question-container" id="quiz-question-container">
              <!-- Question content rendered here -->
            </div>
            
            <!-- Feedback area (shown after submit per question) -->
            <div id="quiz-feedback" class="quiz-feedback hidden"></div>
            
            <div class="quiz-navigation">
              <button class="btn btn-secondary" id="quiz-prev-btn">
                <span class="material-symbols-rounded">arrow_back</span>
                Previous
              </button>
              <button class="btn btn-primary" id="quiz-submit-answer-btn">
                <span class="material-symbols-rounded">check</span>
                Submit
              </button>
              <button class="btn btn-primary hidden" id="quiz-next-btn">
                Next
                <span class="material-symbols-rounded">arrow_forward</span>
              </button>
              <button class="btn btn-success hidden" id="quiz-submit-btn">
                <span class="material-symbols-rounded">done_all</span>
                Finish
              </button>
            </div>
          </div>
        </section>
        
        <!-- Problem Set Results View -->
        <section id="view-quiz-results" class="view">
          <div class="quiz-results">
            <div class="results-header">
              <span class="material-symbols-rounded results-icon">emoji_events</span>
              <h2>Problem Set Complete!</h2>
              <div class="results-score">
                <span id="results-correct">0</span>
                <span class="results-divider">/</span>
                <span id="results-total">0</span>
              </div>
              <span id="results-percent" class="results-percent">0%</span>
              <div id="results-time" class="results-time"></div>
            </div>
            
            <div id="results-breakdown" class="results-breakdown">
              <!-- Question-by-question breakdown -->
            </div>
            
            <div class="results-actions">
              <button class="btn btn-secondary" id="review-quiz-btn">
                <span class="material-symbols-rounded">visibility</span>
                Review Answers
              </button>
              <button class="btn btn-primary" id="retake-quiz-btn">
                <span class="material-symbols-rounded">replay</span>
                Retake
              </button>
              <button class="btn btn-text" id="back-to-quizzes-btn">
                Back to Problem Sets
              </button>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>
  
  <!-- Developer Console -->
  <div id="dev-console" class="dev-console hidden">
    <div class="dev-console-header">
      <span>Developer Console</span>
      <button class="icon-btn" onclick="toggleDevConsole()">
        <span class="material-symbols-rounded">close</span>
      </button>
    </div>
    <div id="dev-console-output" class="dev-console-output"></div>
  </div>
  
  <!-- Note Viewer Overlay -->
  <div id="note-modal" class="viewer-overlay hidden">
    <button class="viewer-back-btn" id="modal-close">
      <span class="material-symbols-rounded">arrow_back</span>
      <span>Close</span>
    </button>
    <div class="viewer-panel">
      <div class="viewer-left">
        <div id="viewer-loading" class="viewer-loading">
          <div class="spinner"></div>
          <p>Loading document preview...</p>
        </div>
        <iframe id="modal-preview-frame" class="viewer-docframe"></iframe>
        <div id="modal-preview-fallback" class="viewer-fallback hidden">
          <span class="material-symbols-rounded">description</span>
          <p>Loading document preview...</p>
        </div>
      </div>
      <div class="viewer-right">
        <div class="viewer-header">
          <span class="viewer-pill" id="modal-format">PDF</span>
          <h2 class="viewer-title" id="modal-title">Note Title</h2>
        </div>
        <div class="viewer-meta">
          <div class="viewer-kv"><span>Author</span> <strong id="modal-author">--</strong></div>
          <div class="viewer-kv"><span>Views</span> <strong id="modal-views">0</strong></div>
          <div class="viewer-kv"><span>Downloads</span> <strong id="modal-downloads">0</strong></div>
          <div class="viewer-kv"><span>Size</span> <strong id="modal-size">--</strong></div>
        </div>
        <div class="viewer-actions">
          <button class="btn btn-primary" id="modal-download">
            <span class="material-symbols-rounded">download</span>
            Download
          </button>
          <button class="btn btn-secondary" id="modal-view-full">
            <span class="material-symbols-rounded">fullscreen</span>
            Full View
          </button>
          <button class="btn btn-secondary" id="modal-open-external">
            <span class="material-symbols-rounded">open_in_new</span>
            Open in Editor
          </button>
          <button class="btn btn-secondary" id="modal-share">
            <span class="material-symbols-rounded">share</span>
            Share
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>
  
  <script type="module" src="/src/main.js"></script>
</body>
</html>
